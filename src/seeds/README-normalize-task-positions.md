# Скрипт нормализации позиций задач

## Описание

Скрипт `normalize-task-positions.ts` проходит по всем колонкам во всех досках и перенумеровывает задачи начиная с 1, 2, 3... в порядке их текущей сортировки по позиции.

## Зачем это нужно?

Из-за особенностей алгоритма позиционирования (использование `POSITION_STEP = 1000`) позиции задач могут уходить в большие значения (1000, 2000, 3000...), что при большом количестве задач может привести к переполнению типа `DECIMAL(10, 4)` (максимум: 999999.9999).

Скрипт нормализует позиции, делая их простыми числами: 1, 2, 3, 4...

## Использование

```bash
npm run seed:normalize-task-positions
```

или напрямую:

```bash
npx ts-node src/seeds/normalize-task-positions.ts
```

## Что делает скрипт

1. Получает все доски в базе данных
2. Для каждой доски получает все колонки, отсортированные по `position: asc`
3. Для каждой колонки получает все задачи, отсортированные по `position: asc`
4. Перенумеровываем задачи начиная с 1: первая задача получает позицию "1.0000", вторая "2.0000", третья "3.0000" и т.д.

## Пример вывода

```
Начинаем нормализацию позиций задач...

Обрабатываем доску: Продажи (ID: 1)
  Колонка "В работе": найдено задач: 15
    ✓ Позиции обновлены: 1, 2, ..., 15

  Колонка "Готово": найдено задач: 42
    ✓ Позиции обновлены: 1, 2, ..., 42

==================================================
✓ Нормализация завершена успешно!
  Обработано колонок: 12
  Обработано задач: 234
==================================================
```

## Безопасность

- Скрипт работает только с не удаленными досками и колонками (`deletedAt: null`)
- Все операции выполняются атомарно (по одной задаче)

## Когда запускать

Рекомендуется запускать после:
- Массового перемещения задач
- После выполнения импорта данных
- Если заметили, что позиции превышают разумные значения
- Периодически для профилактики

## Примечание

После нормализации новые задачи будут получать позицию через `nextPosition()` - это будет `max(position) + 1`, что вернет значение после последней задачи в колонке.

