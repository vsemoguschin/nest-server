# Repository Guidelines

## Структура проекта и модули
- `src/`: исходники NestJS; домены в `src/domains/*` (deals, board_tasks и др.), инфраструктура в `src/prisma`, интеграции и middleware/guards рядом.  
- `test/`: Jest-спеки (`*.spec.ts`); e2e-настройки в `test/jest-e2e.json`.  
- `prisma/`: схема и генерация клиента; после изменений запускайте генерацию.  
- `dist/`: сборка (не редактировать).  
- `public/`: статические файлы.  
- Доп. материалы: `README.md`, `TASKS.md`, заметки `FRONTEND_*`, `NUXT_PLUGIN_*`.

## Сборка, тесты и разработка
- `npm run start:dev`: локальная разработка с watch.  
- `npm run start:debug`: watch + инспектор.  
- `npm run build`: сборка в `dist/`.  
- `npm run start:prod`: запуск собранного.  
- `npm run lint`: ESLint с авто-фиксом.  
- `npm run format`: Prettier по `src/` и `test/`.  
- `npm test` / `npm run test:watch`: юнит-тесты разово/в watch.  
- `npm run test:cov`: покрытие Jest в `coverage/`.  
- `npm run test:e2e`: e2e-суита.  
- `npm run prisma:deploy`: `prisma db push` + `prisma generate` после правок схемы.

## Стиль кода и именование
- TypeScript, NestJS-подход (modules/controllers/services).  
- Отступ 2 пробела, одинарные кавычки, хвостовые запятые — как у Prettier.  
- Файлы — `kebab-case`, классы — `PascalCase`, переменные/функции — `camelCase`.  
- DTO валидируйте через `class-validator`, по возможности помечайте `readonly`.  
- Перед коммитом запускайте `npm run lint` и `npm run format`.

## Тестирование
- Jest + `ts-jest`; тесты в `test/` или рядом с доменами.  
- Имена: `*.spec.ts`, осмысленные `describe/it`.  
- Покрывайте позитивные сценарии и ошибки/валидации; для Prisma-границ пишите интеграционные проверки.  
- Для заметных изменений прогоняйте `npm run test:cov`.

## Коммиты и Pull Request
- Коммиты: коротко, в настоящем времени (например, `Добавить расчет подсветки`), группируйте связанные правки, указывайте ID задач при наличии.  
- PR: краткое описание, список изменений, результаты проверок (`npm test`, `npm run lint` и др.), скриншоты для UI, отметка о миграциях/ENV.  
- Держите диффы точечными, без несвязанных форматирований.  
- Если тронули схему или конфиги, опишите шаги (`prisma:deploy`, переменные окружения).

## Инструкции для агента
- Соблюдай правила выше при любых изменениях.  
- Не трогай чужие незавершенные правки; не выполняй деструктивные команды.  
- При нехватке прав или доступа — запроси явное разрешение.  
- Проверяй работу тестами, если задача затрагивает бизнес-логику или Prisma.  
- Фиксируй пути к файлам в ответах и давай лаконичные резюме изменений.
